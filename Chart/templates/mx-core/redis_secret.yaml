apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-redis-secret
  labels:
    app: {{ template "fullname" . }}
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
type: Opaque
data:
  {{- if .Values.mxcore.externalRedis.enabled -}}
    host: {{ .Values.mxcore.externalRedis.host | b64enc | nindent 4 }}
    port: {{ .Values.mxcore.externalRedis.port | b64enc | nindent 4 }}
    {{ if .Values.mxcore.externalRedis.auth.enabled -}}
      password: {{ .Values.mxcore.externalRedis.auth.password | b64enc | nindent 4 }}
    {{- end -}}
  {{- else -}}
    host: {{ "{{ .Chart.Name }}-redis" | b64enc | nindent 4 }}
    {{- if .Values.redis.auth.enabled -}}
      password: {{ .Values.redis.auth.password | b64enc | nindent 4 }}
    {{- end -}}
  {{- end -}}
